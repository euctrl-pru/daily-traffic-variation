<!DOCTYPE html>
<html lang="en">
<head>
	<title>Aviation Intelligence Portal</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
	<link rel=stylesheet href=https://use.fontawesome.com/releases/v5.7.2/css/all.css integrity=sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr crossorigin=anonymous>
	<meta name="description" content=".img-responsive { margin: 0 auto; max-width: 75% } .resp-container { position: relative; overflow: hidden; padding-top: 50.">
	
	<!-- Google Font -->
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Exo:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
	  <!-- Bootstrap CSS -->  
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
	<!-- Plugins CSS -->
	<link rel="stylesheet" type="text/css" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css">
	<!-- Theme CSS -->
	<link rel="stylesheet" type="text/css" href="assets/css/style.css">  
</head>

<body onresize="ResizeWindow()">

    <div id="content"></div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            fetch('aiu-header.html')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.text();
                })
                .then(data => {
                    document.getElementById('content').innerHTML = data;
					
					// Comment for Denis: Here you can set the title and description for the header
					document.getElementById('aiu-header-title').textContent = "Daily en-route ATFM";
                	document.getElementById('aiu-header-description').textContent = "An interactive overview of the daily en-route ATFM and other properties.";
                })
                .catch(error => {
                    console.error('There was a problem with the fetch operation:', error);
                });
        });
    </script>

<style>
	table, td {
		border: 1px solid black;
		border-collapse: collapse;
		background-color: White;
		padding: 5px;
		align: middle;    
	}
</style>

	<nav class="navbar navbar-expand-md navbar-dark sticky-top" style="background-color: lightslategray;">
	<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
		<span class="navbar-toggler-icon"></span>
	</button>
	<!-- <nav class="navbar navbar-expand-md bg-dark navbar-dark fixed-top"> -->
	<!-- <a href="http://www.eurocontrol.int/"><img src="Pictures/Eurocontrol_logo_2010.svg" style="float:left" class="img" alt="Eurocontrol" width="50" height="50"></a> -->
    

<!--	<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
		<span class="navbar-toggler-icon"></span>
	</button>-->

	<!--<div class="collapse navbar-collapse" id="collapsibleNavbar">-->
		<ul class="nav navbar-nav">
			<li class="nav-item active">
				<a class="nav-link" href="#"> Balance ScoreCard<span class="sr-only">(current)</span></a>
			</li>
			<li class="nav-item dropdown">
				<a class="nav-link dropdown-toggle" href="#" id="navbardrop" data-toggle="dropdown"> Daily Traffic</a>
				<div class="dropdown-menu">
					<strong>&nbsp States</strong>
					<a class="dropdown-item" href="./DailyTrafficVariation-States.html"> Daily Variation</a>
					<a class="dropdown-item" href="./DailyTrafficRestart-States.html"> Overview of the evolution</a>

					<strong>&nbsp ACCs</strong>
					<a class="dropdown-item" href="./DailyTrafficVariation-ACCs.html"> Daily Variation</a>
					<a class="dropdown-item" href="./DailyTrafficRestart-ACCs.html"> Overview of the evolution</a>

					<strong>&nbsp Airports</strong>
					<a class="dropdown-item" href="./DailyTrafficVariation-Airports.html"> Daily Variation</a>
					<a class="dropdown-item" href="./DailyTrafficRestart-Airports.html"> Overview of the evolution</a>

					<strong>&nbsp Aircraft Operators</strong>
					<a class="dropdown-item" href="./DailyTrafficVariation-AOs.html"> Daily Variation</a>
					<a class="dropdown-item" href="./DailyTrafficRestart-AOs.html"> Overview of the evolution</a>
				</div>
			</li>

			<li class="nav-item dropdown">
				<a class="nav-link dropdown-toggle" href="#" id="navbardrop" data-toggle="dropdown"> Daily Punctuality</a>
				<div class="dropdown-menu">
					<a class="dropdown-item" href="./DailyPunctuality-States.html"> States</a>
					<a class="dropdown-item" href="./DailyPunctuality-Airports.html"> Airports</a>
				</div>
			</li>
			
			<li class="nav-item dropdown">
				<a class="nav-link dropdown-toggle" href="#" id="navbardrop" data-toggle="dropdown"> Daily Operated Schedules %</a>
				<div class="dropdown-menu">
					<a class="dropdown-item" href="./DailyOperatedSchedules-Airports.html"> Airports</a>
				</div>
			</li>
		</ul>
	</div>
</nav>

	
<body>
	<style>
		font-family: Arial;
		font-size: 20px;
	</style>

	<br>

<div class="container-fluid">

		<div id="ANSP_filter_div"></div>
		<div id="Year_filter_div"></div>
		<div id="Month_filter_div"></div>
		<div id="Metric_filter_div"></div>
		<div id="ChartANSPsYearYTD_div"></div>

	</div>
</body>

<!-- ======================= Footer START -->
<div id="content-footer"></div>
<script>
	document.addEventListener("DOMContentLoaded", function() {
		fetch('aiu-footer.html')
			.then(response => {
				if (!response.ok) {
					throw new Error('Network response was not ok');
				}
				return response.text();
			})
			.then(data => {
				document.getElementById('content-footer').innerHTML = data;
			})
			.catch(error => {
				console.error('There was a problem with the fetch operation:', error);
			});
	});
</script>
<!-- ======================= Footer END -->

</html>

<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

<script type="text/javascript">
	var SelectedANSP = "EUROCONTROL Area (MS)";
	var SelectedMetric = 'En-Route ATFM delays per cause';
	var NameMonths = ['January','February','March','April','May','June','July','August','September','October','November','December'];
	var SelectedYear = 2024;
	var SelectedMonth = 5;
	var Mois;

	var ANSP_Picker;
	var Year_Picker;
	var Month_Picker;
	var Metric_Picker;
	
	var ChartANSPsYearYTD;
	
	google.charts.load('current', {'packages':['corechart','table']});
	google.charts.setOnLoadCallback(drawCallback);

	function drawCallback() {
		ChartANSPsYearYTD = new google.visualization.ColumnChart(document.getElementById("ChartANSPsYearYTD_div"));
		google.visualization.events.addListener(ChartANSPsYearYTD, 'select', selectChartANSPsYearYTD);

		drawVisualization();
	}
	
	function selectChartANSPsYearYTD() {
		if(ChartANSPsYearYTD.getSelection() != "") {
//			alert('Je passe par ici');
			SelectedANSP = ViewDataANSPsYearYTD3.getValue(ChartANSPsYearYTD.getSelection()[0].row, 0);
//			alert(SelectedANSP);
			var Metric = ViewDataANSPsYearYTD3.getColumnLabel(ChartANSPsYearYTD.getSelection()[0].column);
			if (Metric == 'Flights') SelectedMetric = "Number of flights";
			if (Metric == 'Average flights per day') SelectedMetric = "Average number of flights per day";
			if (Metric == 'Delayed Flights') SelectedMetric = "Number of delayed flights";
			if (Metric == 'Delays') SelectedMetric = "En-Route ATFM delays";
			if (Metric == 'En-route delay per flight') SelectedMetric = "En-Route ATFM delays per flight";
			if (Metric == 'En-route delay per delayed flight') SelectedMetric = "En-Route ATFM delays per delayed flight";
			if (Metric == 'Capacity (ATC)') SelectedMetric = "En-Route ATFM delays - Capacity (ATC)";
			if (Metric == 'Staffing (ATC)') SelectedMetric = "En-Route ATFM delays - Staffing (ATC)";
			if (Metric == 'Disruptions (ATC)') SelectedMetric = "En-Route ATFM delays - Disruptions (ATC)";
			if (Metric == 'Weather') SelectedMetric = "En-Route ATFM delays - Weather";
			if (Metric == 'Other') SelectedMetric = "En-Route ATFM delays - Other";
//			alert(Metric);
//			alert(SelectedMetric);
			drawVisualization();
		}
	}		

	function drawVisualization() {
		//--------------------------------- ANSP Picker ------------------------------------------------------
		var dataANSPs = google.visualization.arrayToDataTable([
			['ANSPs'],
			['Albcontrol'],
			['ANS CR'],
			['Fintraffic ANS'],
			['ARMATS'],
			['Austro Control'],
			['Avinor'],
			['BULATSA'],
			['Croatia Control'],
			['DCAC Cyprus'],
			['DFS'],
			['DHMI'],
			['DSNA'],
			['EANS'],
			['ENAIRE'],
			['ENAV'],
			['EUROCONTROL Area (MS)'],
			['HCAA'],
			['HungaroControl (EC)'],
			['IAA'],
			['Israel AA'],
			['LFV'],
			['LGS'],
			['LPS'],
			['LVNL'],
			['MATS'],
			['M-NAV'],
			['MoldATSA'],
			['MUAC'],
			['NATS (Continental)'],
			['NAV Portugal (Continental)'],
			['NAVIAIR'],
			['ONDA'],
			['Oro Navigacija'],
			['PANSA'],
			['ROMATSA'],
			['Sakaeronavigatsia'],
			['skeyes'],
			['Skyguide'],
			['Slovenia Control'],
			['SMATSA'],
			['UkSATSE']
		]);

		ANSP_Picker = new google.visualization.ControlWrapper({
			controlType: 'CategoryFilter',
			containerId: 'ANSP_filter_div',
//			dataSourceUrl: 'https://docs.google.com/spreadsheets/d/1G24H6SUIBbqWLgqg6ImBRQqBMDIH8EEdCcqO6DLh95k/edit?usp=sharing',
			dataTable: dataANSPs,
			state: {selectedValues: [SelectedANSP]},
			options: {
				filterColumnIndex: 0,
				ui: {
					label: 'ANSP:',
					caption: 'Select the ANSP',
					labelStacking: 'horizontal',
					allowTyping: false,
					allowMultiple: false,
					sortValues: true,
					allowNone: false,
				},
			}
		});
		ANSP_Picker.draw();
		google.visualization.events.addListener(ANSP_Picker, 'statechange', changeANSP_Picker);		
		function changeANSP_Picker () {
			SelectedANSP = ANSP_Picker.getState().selectedValues[0];
			drawVisualization();
		};
		//--------------------------------- Metric Picker ------------------------------------------------------
		var dataMetrics = google.visualization.arrayToDataTable([
			['Metric'],
			['Number of flights'],
			['Average number of flights per day'],
			['Number of delayed flights'],
			['Share of delayed flights'],
			['En-Route ATFM delays'],
			['En-Route ATFM delays per cause'],
			['En-Route ATFM delays per flight'],
			['En-Route ATFM delays per delayed flight'],
			['En-Route ATFM delays - Capacity (ATC)'],
			['En-Route ATFM delays - Staffing (ATC)'],
			['En-Route ATFM delays - Disruptions (ATC)'],
			['En-Route ATFM delays - Weather'],
			['En-Route ATFM delays - Other'],
		]);
		
		Metric_Picker = new google.visualization.ControlWrapper({
			controlType: 'CategoryFilter',
			containerId: 'Metric_filter_div',
			dataTable: dataMetrics,
			state: {selectedValues: [SelectedMetric]},
			options: {
				filterColumnIndex: 0,
				ui: {
					label: 'Metric:',
					caption: 'Select the metric',
					labelStacking: 'horizontal',
					allowTyping: false,
					allowMultiple: false,
					sortValues: false,
					allowNone: false,
				},
			}
		});
		Metric_Picker.draw();
		google.visualization.events.addListener(Metric_Picker, 'statechange', changeMetric_Picker);		
		function changeMetric_Picker () {
			SelectedMetric = Metric_Picker.getState().selectedValues[0];
			drawVisualization();
		};
		//--------------------------------- Year Picker ------------------------------------------------------
		var dataYears = google.visualization.arrayToDataTable([
			['Years'],
			[2016],
			[2017],
			[2018],
			[2019],
			[2020],
			[2021],
			[2022],
			[2023]
		]);
		Year_Picker = new google.visualization.ControlWrapper({
			controlType: 'CategoryFilter',
			containerId: 'Year_filter_div',
			dataTable: dataYears,
			state: {selectedValues: [SelectedYear]},
			options: {
				filterColumnIndex: 0,
				ui: {
					label: 'Year:',
					caption: 'Select the Year',
					labelStacking: 'horizontal',
					allowTyping: false,
					allowMultiple: false,
					sortValues: false,
					allowNone: false,
				},
			}
		});
		Year_Picker.draw();
		google.visualization.events.addListener(Year_Picker, 'statechange', changeYear_Picker);		
		function changeYear_Picker () {
			SelectedYear = Year_Picker.getState().selectedValues[0];
			if ((SelectedYear == LastAvailableYear) && (SelectedMonth > LastAvailableMonth)) SelectedMonth = LastAvailableMonth;
			drawVisualization();
		};
		//--------------------------------- Month Picker ------------------------------------------------------
		var dataMonths = google.visualization.arrayToDataTable([
			['Months'],
			[1],
			[2],
			[3],
			[4],
			[5],
			[6],
			[7],
			[8],
			[9],
			[10],
			[11],
			[12],
		]);
		Month_Picker = new google.visualization.ControlWrapper({
			controlType: 'CategoryFilter',
			containerId: 'Month_filter_div',
			dataTable: dataMonths,
			state: {selectedValues: [SelectedMonth]},
			options: {
				filterColumnIndex: 0,
				ui: {
					label: 'Month:',
					caption: 'Select the Month',
					labelStacking: 'horizontal',
					allowTyping: false,
					allowMultiple: false,
					sortValues: false,
					allowNone: false,
				},
			}
		});
		Month_Picker.draw();
		google.visualization.events.addListener(Month_Picker, 'statechange', changeMonth_Picker);		
		function changeMonth_Picker () {
			var i = Month_Picker.getState().selectedValues[0];
			if ((i <= LastAvailableMonth) || (SelectedYear < LastAvailableYear)) {
				SelectedMonth = Month_Picker.getState().selectedValues[0];
			};
			drawVisualization();
		};
		
		if (SelectedMonth == 1) Mois="January";
		if (SelectedMonth == 2) Mois="February";
		if (SelectedMonth == 3) Mois="March";
		if (SelectedMonth == 4) Mois="April";
		if (SelectedMonth == 5) Mois="May";
		if (SelectedMonth == 6) Mois="June";
		if (SelectedMonth == 7) Mois="July";
		if (SelectedMonth == 8) Mois="August";
		if (SelectedMonth == 9) Mois="September";
		if (SelectedMonth == 10) Mois="October";
		if (SelectedMonth == 11) Mois="November";
		if (SelectedMonth == 12) Mois="December";

		var query1 = new google.visualization.Query('https://docs.google.com/spreadsheets/d/1G24H6SUIBbqWLgqg6ImBRQqBMDIH8EEdCcqO6DLh95k/edit?usp=sharing');
		query1.setQuery('select A, B, C, D, sum(F), sum(G), sum(H), sum(I), sum(J), sum(K), sum(L), sum(M), sum(N) where (E<='+SelectedMonth+') group by A, B, C, D');
		query1.send(QueryANSPsYearYTD);

		var query2 = new google.visualization.Query('https://docs.google.com/spreadsheets/d/1G24H6SUIBbqWLgqg6ImBRQqBMDIH8EEdCcqO6DLh95k/edit?usp=sharing');
		query2.setQuery('select E, sum(F), sum(G), sum(H), sum(I), sum(J), sum(K), sum(L), sum(M), sum(N) where ((B="'+SelectedANSP+'") and (C="All") and (D='+ SelectedYear+')) group by B, C, D, E');
		query2.send(QueryANSPMonths);
		
		
//------------------------------QueryANSPMonths----------------------------------
		function QueryANSPMonths(response) {
			if (response.isError()) {
				alert('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
				return;
			}
			DataANSPMonths = response.getDataTable();

/*			var Table1 = new google.visualization.Table(document.getElementById('Table1_div'));
			Table1.draw(DataANSPMonths, {showRowNumber: true, width: '100%', height: '100%'});*/

			DataANSPMonths.setColumnLabel(1, "Flights");
			DataANSPMonths.setColumnLabel(2, "Delayed Flights");
			DataANSPMonths.setColumnLabel(3, "Delays");
			DataANSPMonths.setColumnLabel(4, "Capacity (ATC)");
			DataANSPMonths.setColumnLabel(5, "Staffing (ATC)");
			DataANSPMonths.setColumnLabel(6, "Disruptions (ATC)");
			DataANSPMonths.setColumnLabel(7, "Weather");
			DataANSPMonths.setColumnLabel(8, "Other");
			DataANSPMonths.setColumnLabel(9, "NbDays");

			DataANSPMonths.addColumn('number', 'En-route delay per flight');
			DataANSPMonths.addColumn('number', 'En-route delay per delayed flight');
			DataANSPMonths.addColumn('number', 'Share of delayed flight');
			DataANSPMonths.addColumn('number', 'Average flights per day');

			var NbFlights;
			var NbDelayedFlights;
			for (i=0 ; i < DataANSPMonths.getNumberOfRows(); i++) {
				NbFlights = DataANSPMonths.getValue(i,1);
				if (NbFlights == 0) DataANSPMonths.setValue(i,10,0);
				 else DataANSPMonths.setValue(i,10,DataANSPMonths.getValue(i,3)/NbFlights);
				
				NbDelayedFlights = DataANSPMonths.getValue(i,2);
				if ((NbDelayedFlights == 0) || (NbDelayedFlights == null)) DataANSPMonths.setValue(i,11,0);
				 else DataANSPMonths.setValue(i,11,DataANSPMonths.getValue(i,3)/NbDelayedFlights); 

				if (NbFlights == 0) DataANSPMonths.setValue(i,12,0);
				 else DataANSPMonths.setValue(i,12,NbDelayedFlights/NbFlights);

				DataANSPMonths.setValue(i,13,NbFlights/DataANSPMonths.getValue(i,9)); 
			}
			
			var Formatter2DecimalsFigure = new google.visualization.NumberFormat({pattern:'0.00'});
			Formatter2DecimalsFigure.format(DataANSPMonths, 10);
			Formatter2DecimalsFigure.format(DataANSPMonths, 11);

			var Formatter1DecimalPercentage = new google.visualization.NumberFormat({pattern:'0.0%'});
			Formatter1DecimalPercentage.format(DataANSPMonths, 12);

			var Formatter0DecimalFigure = new google.visualization.NumberFormat({pattern:'#,###,###'});
			Formatter0DecimalFigure.format(DataANSPMonths, 13);
			
			DataANSPMonths.addColumn('string', 'Month');
			for (i=0 ; i<DataANSPMonths.getNumberOfRows(); i++) {
				DataANSPMonths.setValue(i,14,NameMonths[DataANSPMonths.getValue(i,0)-1]);
			}
			
/*			var Table1 = new google.visualization.Table(document.getElementById('Table1_div'));
			Table1.draw(DataANSPMonths, {showRowNumber: true, width: '100%', height: '100%'});*/
			
		
			var OptionsANSPMonths = {
				title: TitreGraphique+' ('+SelectedANSP+')('+SelectedYear+')',
				width: 400,
				height: 500,
				legend: {
					position: 'none',
					maxLines: 3,
				},
				bar: {groupWidth: '75%' },
				isStacked: true,
				series: {
					0: {color: MyColour},
				},
				vAxes: {
					0: {format: MyFormat},
				},
				hAxis: {
					textPosition: 'out',
					textStyle: {fontSize: 13},
					slantedText: true,
					slantedTextAngle: 90,
//					ticks: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
				},
				chartArea: {
					left: 90,
					top: 50,
//					width: 1100,
				},
				animation: {
					duration: 600,
					easing: 'inAndOut',
				},
			};
			ChartANSPMonths.draw(ViewDataANSPMonths, OptionsANSPMonths);
			SelectMonthInChartANSPMonths();
			function SelectMonthInChartANSPMonths() {
				for(j = 0; j < ViewDataANSPMonths.getNumberOfRows(); j++) {
					if (ViewDataANSPMonths.getValue(j,0) == Mois) {
//						alert("Trouvé " + Mois + " en " + j);
						ChartANSPMonths.setSelection([{row: j , column:null}]);
					}
				}
			}
		}
			
		function QueryANSPsYearYTD(response) {
			if (response.isError()) {
				alert('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
				return;
			}
			DataANSPsYearYTD = response.getDataTable();
			
/*			var Table1 = new google.visualization.Table(document.getElementById('Table1_div'));
			Table1.draw(DataANSPsYearYTD, {showRowNumber: true, width: '100%', height: '100%'});*/

			DataANSPsYearYTD.setColumnLabel(4, "Flights");
			DataANSPsYearYTD.setColumnLabel(5, "Delayed Flights");
			DataANSPsYearYTD.setColumnLabel(6, "Delays");
			DataANSPsYearYTD.setColumnLabel(7, "Capacity (ATC)");
			DataANSPsYearYTD.setColumnLabel(8, "Staffing (ATC)");
			DataANSPsYearYTD.setColumnLabel(9, "Disruptions (ATC)");
			DataANSPsYearYTD.setColumnLabel(10, "Weather");
			DataANSPsYearYTD.setColumnLabel(11, "Other");
			DataANSPsYearYTD.setColumnLabel(12, "NbDays");

			DataANSPsYearYTD.addColumn('number', 'En-route delay per flight');
			DataANSPsYearYTD.addColumn('number', 'En-route delay per delayed flight');
			DataANSPsYearYTD.addColumn('number', 'Share of delayed flight');
			DataANSPsYearYTD.addColumn('number', 'Average flights per day');

			var NbFlights;
			var NbDelayedFlights;
			for (i=0 ; i < DataANSPsYearYTD.getNumberOfRows(); i++) {
				NbFlights = DataANSPsYearYTD.getValue(i,4);
				if (NbFlights == 0) DataANSPsYearYTD.setValue(i,13,0);
				 else DataANSPsYearYTD.setValue(i,13,DataANSPsYearYTD.getValue(i,6)/NbFlights);
				
				NbDelayedFlights = DataANSPsYearYTD.getValue(i,5);
				if ((NbDelayedFlights == 0) || (NbDelayedFlights == null)) DataANSPsYearYTD.setValue(i,14,0);
				 else DataANSPsYearYTD.setValue(i,14,DataANSPsYearYTD.getValue(i,6)/NbDelayedFlights); 

				if (NbFlights == 0) DataANSPsYearYTD.setValue(i,15,0);
				 else DataANSPsYearYTD.setValue(i,15,NbDelayedFlights/NbFlights);
				 
				DataANSPsYearYTD.setValue(i,16,NbFlights/DataANSPsYearYTD.getValue(i,12)); 
			 }

			var FormatterGeneralFigure = new google.visualization.NumberFormat({pattern:'0000'});
			FormatterGeneralFigure.format(DataANSPsYearYTD, 3);
			
			var Formatter2DecimalsFigure = new google.visualization.NumberFormat({pattern:'0.00'});
			Formatter2DecimalsFigure.format(DataANSPsYearYTD, 13);
			Formatter2DecimalsFigure.format(DataANSPsYearYTD, 14);

			var Formatter1DecimalPercentage = new google.visualization.NumberFormat({pattern:'0.0%'});
			Formatter1DecimalPercentage.format(DataANSPsYearYTD, 15);

			var Formatter0DecimalFigure = new google.visualization.NumberFormat({pattern:'#,###,###'});
			Formatter0DecimalFigure.format(DataANSPsYearYTD, 16);
			
			var TitreGraphique;
			var MyColour;
			var MyFormat="#,###,###";
			
			ViewDataANSPsYearYTD = new google.visualization.DataView(DataANSPsYearYTD);
			ViewDataANSPsYearYTD.setRows(ViewDataANSPsYearYTD.getFilteredRows([{column: 2, value: "All"}, {column: 3, value: SelectedYear}]));
			
			var ViewDataANSPsYearYTD2 = new google.visualization.DataView(ViewDataANSPsYearYTD);
			
			if(SelectedMetric=='Number of flights') {
				ViewDataANSPsYearYTD2.setRows(ViewDataANSPsYearYTD2.getSortedRows([{column: 4, desc: true}]));
				ViewDataANSPsYearYTD2.setColumns([1, 4]);
				TitreGraphique = 'Number of flights per ANSP';
				MyColour = 'RoyalBlue';
				ViewDataANSPsYearYTD3 = new google.visualization.DataView(ViewDataANSPsYearYTD2);
				ViewDataANSPsYearYTD3.setRows(1, ViewDataANSPsYearYTD3.getNumberOfRows()-1);
			};

			if(SelectedMetric=='Average number of flights per day') {
				ViewDataANSPsYearYTD2.setRows(ViewDataANSPsYearYTD2.getSortedRows([{column: 16, desc: true}]));
				ViewDataANSPsYearYTD2.setColumns([1, 16]);
				TitreGraphique = 'Average number of flights per day';
				MyColour = 'RoyalBlue';
				ViewDataANSPsYearYTD3 = new google.visualization.DataView(ViewDataANSPsYearYTD2);
				ViewDataANSPsYearYTD3.setRows(1, ViewDataANSPsYearYTD3.getNumberOfRows()-1);
			};
			
			if(SelectedMetric=='Number of delayed flights') {
				ViewDataANSPsYearYTD2.setRows(ViewDataANSPsYearYTD2.getSortedRows([{column: 5, desc: true}]));
				ViewDataANSPsYearYTD2.setColumns([1, 5]);
				TitreGraphique = 'Number of delayed flights per ANSP';
				MyColour = 'RoyalBlue';
				ViewDataANSPsYearYTD3 = new google.visualization.DataView(ViewDataANSPsYearYTD2);
				ViewDataANSPsYearYTD3.setRows(1, ViewDataANSPsYearYTD3.getNumberOfRows()-1);
			};
			
			if(SelectedMetric=='Share of delayed flights') {
				ViewDataANSPsYearYTD2.setRows(ViewDataANSPsYearYTD2.getSortedRows([{column: 15, desc: true}]));
				ViewDataANSPsYearYTD2.setColumns([1, 15]);
				TitreGraphique = 'Share of delayed flights per ANSP';
				MyColour = 'RoyalBlue';
				MyFormat="0.0%";
				ViewDataANSPsYearYTD3 = new google.visualization.DataView(ViewDataANSPsYearYTD2);
				ViewDataANSPsYearYTD3.setRows(1, ViewDataANSPsYearYTD3.getNumberOfRows()-1);
			};

			if(SelectedMetric=='En-Route ATFM delays per cause') {
				ViewDataANSPsYearYTD2.setRows(ViewDataANSPsYearYTD2.getSortedRows([{column: 6, desc: true}]));
				ViewDataANSPsYearYTD2.setColumns([1, 7, 8, 9, 10, 11]);
				TitreGraphique = 'En-Route ATFM delays per cause per ANSP';
				MyColour = 'RoyalBlue';
				ViewDataANSPsYearYTD3 = new google.visualization.DataView(ViewDataANSPsYearYTD2);
				ViewDataANSPsYearYTD3.setRows(1, ViewDataANSPsYearYTD3.getNumberOfRows()-1);
			};
			
			if(SelectedMetric=='En-Route ATFM delays') {
				ViewDataANSPsYearYTD2.setRows(ViewDataANSPsYearYTD2.getSortedRows([{column: 6, desc: true}]));
				ViewDataANSPsYearYTD2.setColumns([1, 6]);
				TitreGraphique = 'En-Route ATFM delays per ANSP';
				MyColour = 'RoyalBlue';
				ViewDataANSPsYearYTD3 = new google.visualization.DataView(ViewDataANSPsYearYTD2);
				ViewDataANSPsYearYTD3.setRows(1, ViewDataANSPsYearYTD3.getNumberOfRows()-1);
			};
			
			if(SelectedMetric=='En-Route ATFM delays per flight') {
				ViewDataANSPsYearYTD2.setRows(ViewDataANSPsYearYTD2.getSortedRows([{column: 13, desc: true}]));
				ViewDataANSPsYearYTD2.setColumns([1, 13]);
				TitreGraphique = 'En-Route ATFM delays per flight per ANSP';
				MyColour = 'RoyalBlue';
				MyFormat="0.00";
				ViewDataANSPsYearYTD3 = new google.visualization.DataView(ViewDataANSPsYearYTD2);
			};

			if(SelectedMetric=='En-Route ATFM delays per delayed flight') {
				ViewDataANSPsYearYTD2.setRows(ViewDataANSPsYearYTD2.getSortedRows([{column: 14, desc: true}]));
				ViewDataANSPsYearYTD2.setColumns([1, 14]);
				TitreGraphique = 'En-Route ATFM delays per delayed flight per ANSP';
				MyColour = 'RoyalBlue';
				MyFormat="0.0";
				ViewDataANSPsYearYTD3 = new google.visualization.DataView(ViewDataANSPsYearYTD2);
			};
			
			if(SelectedMetric=='En-Route ATFM delays - Capacity (ATC)') {
				ViewDataANSPsYearYTD2.setRows(ViewDataANSPsYearYTD2.getSortedRows([{column: 7, desc: true}]));
				ViewDataANSPsYearYTD2.setColumns([1, 7]);
				TitreGraphique = 'En-Route ATFM delays - Capacity (ATC) - per ANSP';
				MyColour = 'RoyalBlue';
				ViewDataANSPsYearYTD3 = new google.visualization.DataView(ViewDataANSPsYearYTD2);
				ViewDataANSPsYearYTD3.setRows(1, ViewDataANSPsYearYTD3.getNumberOfRows()-1);
			};

			if(SelectedMetric=='En-Route ATFM delays - Staffing (ATC)') {
				ViewDataANSPsYearYTD2.setRows(ViewDataANSPsYearYTD2.getSortedRows([{column: 8, desc: true}]));
				ViewDataANSPsYearYTD2.setColumns([1, 8]);
				TitreGraphique = 'En-Route ATFM delays - Staffing (ATC) - per ANSP';
				MyColour = 'Red';
				ViewDataANSPsYearYTD3 = new google.visualization.DataView(ViewDataANSPsYearYTD2);
				ViewDataANSPsYearYTD3.setRows(1, ViewDataANSPsYearYTD3.getNumberOfRows()-1);
			};
					
			if(SelectedMetric=='En-Route ATFM delays - Disruptions (ATC)') {
				ViewDataANSPsYearYTD2.setRows(ViewDataANSPsYearYTD2.getSortedRows([{column: 9, desc: true}]));
				ViewDataANSPsYearYTD2.setColumns([1, 9]);
				TitreGraphique = 'En-Route ATFM delays - Disruptions (ATC) - per ANSP';
				MyColour = 'Orange';
				ViewDataANSPsYearYTD3 = new google.visualization.DataView(ViewDataANSPsYearYTD2);
				ViewDataANSPsYearYTD3.setRows(1, ViewDataANSPsYearYTD3.getNumberOfRows()-1);
			};
					
			if(SelectedMetric=='En-Route ATFM delays - Weather') {
				ViewDataANSPsYearYTD2.setRows(ViewDataANSPsYearYTD2.getSortedRows([{column: 10, desc: true}]));
				ViewDataANSPsYearYTD2.setColumns([1, 10]);
				TitreGraphique = 'En-Route ATFM delays - Weather - per ANSP';
				MyColour = 'Green';
				ViewDataANSPsYearYTD3 = new google.visualization.DataView(ViewDataANSPsYearYTD2);
				ViewDataANSPsYearYTD3.setRows(1, ViewDataANSPsYearYTD3.getNumberOfRows()-1);
			};
					
			if(SelectedMetric=='En-Route ATFM delays - Other') {
				ViewDataANSPsYearYTD2.setRows(ViewDataANSPsYearYTD2.getSortedRows([{column: 11, desc: true}]));
				ViewDataANSPsYearYTD2.setColumns([1, 11]);
				TitreGraphique = 'En-Route ATFM delays - Other - per ANSP';
				MyColour = 'Purple';
				ViewDataANSPsYearYTD3 = new google.visualization.DataView(ViewDataANSPsYearYTD2);
				ViewDataANSPsYearYTD3.setRows(1, ViewDataANSPsYearYTD3.getNumberOfRows()-1);
			};
					
//------------------------------Delays per cause per ANSP for a specific year------------------------------
			var OptionsANSPsYearYTD = {
				title: TitreGraphique+' (January - '+NameMonths[SelectedMonth-1]+' '+SelectedYear+')',
				width: 1500,
				height: 600,
				legend: {
					position: 'bottom',
					maxLines: 3,
				},
				bar: {groupWidth: '75%' },
				isStacked: true,
				series: {
					0: {color: MyColour},
				},
				vAxes: {
					0: {format: MyFormat},
				},
				hAxis: {
					textPosition: 'out',
					textStyle: {fontSize: 13},
					slantedText: true,
					slantedTextAngle: 90,
				},
				chartArea: {
					left: 90,
					top: 50,
					width: 1400,
				},
				animation: {
					duration: 600,
					easing: 'inAndOut',
				},
			};
			ChartANSPsYearYTD.draw(ViewDataANSPsYearYTD3, OptionsANSPsYearYTD);
			SelectANSPInChartANSPsYearYTD();
			function SelectANSPInChartANSPsYearYTD() {
				for(j = 0; j < ViewDataANSPsYearYTD3.getNumberOfRows(); j++) {
					if (ViewDataANSPsYearYTD3.getValue(j,0) == SelectedANSP) {
//						alert("Trouv� " + SelectedANSP + " en " + j);
						ChartANSPsYearYTD.setSelection([{row: j , column:null}]);
					}
				}
			}

		
		};
	};	  
</script>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-RJ3R0C35X7"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-RJ3R0C35X7');
</script>