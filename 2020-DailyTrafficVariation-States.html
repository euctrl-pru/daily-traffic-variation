<!DOCTYPE html>
<html lang="en">
<head>
	<title>Aviation Intelligence Portal</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
	<link rel=stylesheet href=https://use.fontawesome.com/releases/v5.7.2/css/all.css integrity=sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr crossorigin=anonymous>
	<meta name="description" content=".img-responsive { margin: 0 auto; max-width: 75% } .resp-container { position: relative; overflow: hidden; padding-top: 50.">
	
	<!-- Google Font -->
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Exo:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
	  <!-- Bootstrap CSS -->  
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
	<!-- Plugins CSS -->
	<link rel="stylesheet" type="text/css" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css">
	<!-- Theme CSS -->
	<link rel="stylesheet" type="text/css" href="assets/css/style.css">  
</head>

<body onresize="ResizeWindow()">

    <div id="content"></div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            fetch('aiu-header.html')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.text();
                })
                .then(data => {
                    document.getElementById('content').innerHTML = data;
					
					// Comment for Denis: Here you can set the title and description for the header
					document.getElementById('aiu-header-title').textContent = "Daily traffic variation for states";
                	document.getElementById('aiu-header-description').textContent = "An overview of the daily traffic variation for states in 2020.";
                })
                .catch(error => {
                    console.error('There was a problem with the fetch operation:', error);
                });
        });
    </script>

<style>
	table, td {
		border: 1px solid black;
		border-collapse: collapse;
		background-color: White;
		padding: 5px;
		align: middle;    
	}
</style>

	<nav class="navbar navbar-expand-md navbar-dark" style="background-color: lightslategray;">
	<!-- <nav class="navbar navbar-expand-md bg-dark navbar-dark fixed-top"> -->
	<!-- <a href="http://www.eurocontrol.int/"><img src="Pictures/Eurocontrol_logo_2010.svg" style="float:left" class="img" alt="Eurocontrol" width="50" height="50"></a> -->
    

	<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
		<span class="navbar-toggler-icon"></span>
	</button>

	<div class="collapse navbar-collapse" id="collapsibleNavbar">
		<ul class="navbar-nav">
			<li class="nav-item dropdown active">
				<a class="nav-link dropdown-toggle" href="#" id="navbardrop" data-toggle="dropdown"> Daily Traffic Variation </a>
				<div class="dropdown-menu">
					<strong>&nbsp States</strong>
					<a class="dropdown-item active" href="./DailyTrafficVariation-States.html"> Daily Variation</a>
					<a class="dropdown-item" href="./DailyTrafficRestart-States.html"> Overview of the evolution</a>

					<strong>&nbsp ACCs</strong>
					<a class="dropdown-item" href="./DailyTrafficVariation-ACCs.html"> Daily Variation</a>
					<a class="dropdown-item" href="./DailyTrafficRestart-ACCs.html"> Overview of the evolution</a>

					<strong>&nbsp Airports</strong>
					<a class="dropdown-item" href="./DailyTrafficVariation-Airports.html"> Daily Variation</a>
					<a class="dropdown-item" href="./DailyTrafficRestart-Airports.html"> Overview of the evolution</a>

					<strong>&nbsp Aircraft Operators</strong>
					<a class="dropdown-item" href="./DailyTrafficVariation-AOs.html"> Daily Variation</a>
					<a class="dropdown-item" href="./DailyTrafficRestart-AOs.html"> Overview of the evolution</a>
				</div>
			</li>

			<li class="nav-item dropdown">
				<a class="nav-link dropdown-toggle" href="#" id="navbardrop" data-toggle="dropdown"> Daily Punctuality Variation</a>
				<div class="dropdown-menu">
					<a class="dropdown-item" href="./DailyPunctuality-States.html"> States</a>
					<a class="dropdown-item" href="./DailyPunctuality-Airports.html"> Airports</a>
				</div>
			</li>
		</ul>
	</div>
</nav>


<br>

<div class="container-fluid">

	<table border="1">
<!--		<col width="500"> -->
		<tr valign="top">

			<td colspan="2">
				<h2>Daily Traffic Variation - States (2020)</h2>
				<div style='float:left; padding-top: 5px; padding-left: 10px; padding-right: 30px' id="EntityPicker_div"></div>
				<div style='float:left; padding-top: 5px; padding-left: 10px; padding-right: 30px' id="IndicatorPicker_div"></div>
				<button type="button" class="btn btn-info" onclick="ButtonBackTo2021()"><i class="fa fa-step-forward"></i>&nbsp Back to 2021</button>
<!--				<button type="button" class="btn btn-info" onclick="ButtonBackTo2022()"><i class="fa fa-step-forward"></i>&nbsp Back to 2022</button>-->
				<button type="button" class="btn btn-primary" onclick="ButtonFromJanuary()"><i class="fa fa-calendar"></i>&nbsp From 1 January</button>
				<button type="button" class="btn btn-primary" onclick="ButtonFromMarch()"><i class="fa fa-calendar"></i>&nbsp From 1 March</button>
				<button type="button" class="btn btn-primary" onclick="ButtonFromJune()"><i class="fa fa-calendar"></i>&nbsp From 1 June</button>
				<button type="button" class="btn btn-primary" onclick="ButtonFromSeptember()"><i class="fa fa-calendar"></i>&nbsp From 1 September</button>
				<button type="button" class="btn btn-success" onclick="CopyAllImages()"><i class="fa fa-copy"></i>&nbsp Copy all images</button>
				<button type="button" class="btn btn-secondary" onclick="ButtonDownload()"><i class="fa fa-download"></i>&nbsp Download</button>
				<button type="button" class="btn btn-warning" onclick="About()"><i class="fa fa-question-circle"></i>&nbsp About</button>
				<div id="MyTable1_div"></div>
			</td>
		</tr>
		<tr>	
			<td colspan="2">
				<div id="MyEntityChart_div"></div>
				<div id="MyEntityChartRangeFilter_div"></div>
			</td>
		</tr>
		<tr>
			<td colspan="2"><div id="MyGeoEntityChart_div"></div></td>
		</tr>
		<tr>
			<td>
				<h3 style='text-align:center'>Breakdown per ACCs<sup>*</sup></h3>
				<div id="MyGeoACCChart_div"></div>
				<p><sup>*</sup>ACCs with the 10 highest or lowest variations for the "Total Network Manager Area".</p>		
			</td>
			<td>
				<h3 style='text-align:center'>Breakdown per main Airports<sup>*</sup></h3>
				<div id="MyGeoAirportChart_div"></div>
				<p><sup>*</sup>Airports with the 10 highest or lowest variations for the "Total Network Manager Area".</p>
			</td>
<!--			<td>
				<div style='float:left' id="MyGeoACCChart_div"></div>
				<div style='float:left' id="MyGeoAirportChart_div"></div>
			</td> -->
		</tr>
	</table>
</div>	
</body>

<!-- ======================= Footer START -->
<div id="content-footer"></div>
<script>
	document.addEventListener("DOMContentLoaded", function() {
		fetch('aiu-footer.html')
			.then(response => {
				if (!response.ok) {
					throw new Error('Network response was not ok');
				}
				return response.text();
			})
			.then(data => {
				document.getElementById('content-footer').innerHTML = data;
			})
			.catch(error => {
				console.error('There was a problem with the fetch operation:', error);
			});
	});
</script>
<!-- ======================= Footer END -->

</html>

<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

<script type="text/javascript">
	var SelectedStartDate = new Date(2020,0,1,0,0,0,0);
</script>

<script type="text/javascript">
		var Data;
		var ACCData;
		var AirportData;
		
		var MyEntityView;
		var MyEntityView1;
		
		var MyEntityChart;
		var MyGeoEntityChart;
		var MyEntityChartRangeFilter;
		var MyEntityChartRangeFilterView;
		var MyGeoACCChart;
		var MyGeoAirportChart;

		var MyGeoACCView;
		var MyGeoAirportView;
		
		var MyTable1;
		var SelectedIndicator = 'Flights 2020';//
		var SelectedEntity = '-Total Network Manager Area';
		var MyWidthCharts = 1950;
		var MyHeightCharts = 450;
		var MyWidthGeoCharts = 1950;
		var MyHeightGeoCharts = 450;
		var MyWidthGeoACCCharts = 900;
		var MyHeightGeoACCCharts = 450;
		var MyWidthGeoAirportCharts = 1000;
		var MyHeightGeoAirportCharts = 450;
	
		var SelectedEndDate;
		var SelectedDate;		
		var SelectedDate2019;		

		var EntityPicker;
		var IndicatorPicker;

		var maxSecondScale;
		var minSecondScale;

		if (window.innerWidth >1200) {
			MyWidthCharts = window.innerWidth*0.97;
			MyWidthGeoCharts = MyWidthCharts;
			MyWidthGeoACCCharts = MyWidthCharts / 2 *0.92;
			MyWidthGeoAirportCharts = MyWidthCharts / 2 *0.92;
		}

		google.load('visualization', '1.0', {'packages':['corechart', 'table', 'controls']});
		google.setOnLoadCallback(Initialisation);

		function ResizeWindow() {
			if (window.innerWidth >1200) {
				MyWidthCharts = window.innerWidth*0.97;
				MyWidthGeoCharts = MyWidthCharts;
				MyWidthGeoACCCharts = MyWidthCharts / 2 *0.92;
				MyWidthGeoAirportCharts = MyWidthCharts / 2 *0.92;
			}
			else {
				MyWidthCharts = 1200*0.97;
				MyWidthGeoCharts = MyWidthCharts;
				MyWidthGeoACCCharts = MyWidthCharts / 2 * 0.92;
				MyWidthGeoAirportCharts = MyWidthCharts / 2 * 0.92;
/*				MyWidthCharts = 1950;
				MyWidthGeoCharts = 1950;
				MyWidthGeoACCCharts = 900;
				MyWidthGeoAirportCharts = 1000;*/
			}
			drawMainDashboard();
		}
			
		function ButtonDownload() {
			var link=document.createElement('a');
			link.href = "https://www.eurocontrol.int/Economics/Download/2020/2020-States.xlsx";
			link.click();
		}

		function ButtonBackTo2021() {
			window.open("2021-DailyTrafficVariation-States.html","_parent");
		}
		function ButtonBackTo2022() {
			window.open("DailyTrafficVariation-States.html","_parent");
		}

		function ButtonFromJanuary() {
			SelectedStartDate = new Date(2020,0,1,0,0,0,0);
			UpdateMainData();
			UpdateMyEntityChart();
			UpdateMyEntityChartRangeFilter();
			SelectEntityInGeoEntityChart();
		}
		function ButtonFromMarch() {
			SelectedStartDate = new Date(2020,2,1,0,0,0,0);
			UpdateMainData();
			UpdateMyEntityChart();
			UpdateMyEntityChartRangeFilter();
			SelectEntityInGeoEntityChart();
		}
		function ButtonFromJune() {
			SelectedStartDate = new Date(2020,5,1,0,0,0,0);
			UpdateMainData();
			UpdateMyEntityChart();
			UpdateMyEntityChartRangeFilter();
			SelectEntityInGeoEntityChart();
		}
		function ButtonFromSeptember() {
			SelectedStartDate = new Date(2020,8,0,0,0,0);
			UpdateMainData();
			UpdateMyEntityChart();
			UpdateMyEntityChartRangeFilter();
			SelectEntityInGeoEntityChart();
		}

		function CopyAllImages() {
			var myWidth = MyEntityChart.getChartLayoutInterface().getBoundingBox('chartarea').width;
			var myHeight = MyEntityChart.getChartLayoutInterface().getBoundingBox('chartarea').height*2;
			var mySize = "width="+myWidth+",height="+myHeight; 
			
			var myWindow = window.open("", "MsgWindow", mySize);
			myWindow.document.write('<img src="' + MyEntityChart.getImageURI() + '"><img src="' + MyGeoEntityChart.getImageURI() + '"><img src="' + MyGeoACCChart.getImageURI() + '"><img src="' + MyGeoAirportChart.getImageURI() + '">');
		}

		function About() {
			var myWidth = 500;
			var myHeight = 700;
			var mySize = "width="+myWidth+",height="+myHeight; 
			
			var myWindow = window.open("", "MsgWindow", mySize);
			myWindow.document.write("<div class='container-fluid'><link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css'><h2>Daily Traffic Variation - States</h2><p>This page presents the daily variation of Traffic<sup>1</sup> per State compared to 2019<sup>4</sup>.</p><p>Such variation can be explained by many different factors including:</p><ul><li>COVID-19.</li><li>Overall economic downturn.</li><li>Failure of airlines.</li><li>ANSPs' disruptions.</li><li>Airports' disruptions.</li><li>Traffic variation in 2019.</li></ul><p>The graphics on the right present the <strong><span style='color:DodgerBlue'>daily traffic in 2019</span></strong>, the <strong><span style='color:darkBlue'>daily traffic in 2020</span></strong>, the <strong><span style='color:Grey'>daily variation between 2019 and 2020</span></strong> as well as the <strong><span style='color:red'>moving average of the daily variation over the last 7 days</span></strong>.</p><p>The left bottom graphic presents the breakdown of the Traffic<sup>2</sup> variation for each  ACC of the selected State.</p><p>The right bottom graphic presents the breakdown of the Traffic<sup>3</sup> variation for the main airports of the selected State.</p><br><br><p><sup>1</sup>Traffic at State level = Total IFR Flights (including international arrivals, departures, domestics but excluding overflights).</p><p><sup>2</sup>Traffic at ACC level = Total IFR Flights (including international arrivals, departures, domestics and overflights).</p><p><sup>3</sup>Traffic at Airport level = Total Departing and Arriving IFR Flights from/to each airport.</p><p><sup>4</sup>The comparison with previous year is made using the closest similar days: i.e. Monday 03/02/2020 is compared to Monday 04/02/2019.</p></td></div>");
		}

		function Initialisation() {
			var query = new google.visualization.Query('https://docs.google.com/spreadsheets/d/1L-BMU5k5O79jJVjLldnJwP6SJNJJpPefvfg5VIz-uLo/edit?usp=sharing');
			query.send(getData);
		}

		function getData(response) {
			Data = response.getDataTable();
			drawMainDashboard();
		}

//---------------ACC Breakdown-----------------------------
		function drawACCBreakdownDashboard(response) {
			ACCData = response.getDataTable();

			var query = new google.visualization.Query('https://docs.google.com/spreadsheets/d/1nYY449EqlYvxHIr-ywzSIPwPfpxV3MLjeQdeHCpTczY/edit?usp=sharing');
			query.send(drawAirportBreakdownDashboard);

			var FormatterMiniDate = new google.visualization.DateFormat({formatType: 'short'});
			FormatterMiniDate.format(ACCData, 2);

			var FormatterZeroDecimale = new google.visualization.NumberFormat({pattern:'#,###'});
			FormatterZeroDecimale.format(ACCData, 3);
			FormatterZeroDecimale.format(ACCData, 4);

			var FormatterPercentage = new google.visualization.NumberFormat({pattern:'0.0%'});
			FormatterPercentage.format(ACCData, 5);
			FormatterPercentage.format(ACCData, 7);

			MyGeoACCChart = new google.visualization.ComboChart(document.getElementById('MyGeoACCChart_div'));
			
			UpdateACCData();
		}

		function UpdateACCData() {
			if (ACCData != null) {
				var MyGeoACCView1 = new google.visualization.DataView(ACCData);
				if (SelectedEntity == '-Total Network Manager Area') 
					MyGeoACCView1.setRows(ACCData.getFilteredRows([{column:2, value: SelectedDate}]));
				else
					MyGeoACCView1.setRows(ACCData.getFilteredRows([{column:2, value: SelectedDate},{column:9, value: SelectedEntity}]));

				if (SelectedIndicator == 'Daily Variation (Traffic)') MyGeoACCView1.setColumns([0,5]);
				if (SelectedIndicator == 'Flights 2019') MyGeoACCView1.setColumns([0,3]);
				if (SelectedIndicator == 'Flights 2020') MyGeoACCView1.setColumns([0,4]);
				if (SelectedIndicator == 'Weekly Moving Average (Traffic)') MyGeoACCView1.setColumns([0,7]);

				var MyGeoACCView2 = new google.visualization.DataView(MyGeoACCView1);
				MyGeoACCView2.setRows(MyGeoACCView2.getSortedRows([{column: 1, desc: true}]));
					
				MyGeoACCView = new google.visualization.DataView(MyGeoACCView2);

				if (SelectedEntity == '-Total Network Manager Area') {
					var NbRows = MyGeoACCView.getNumberOfRows();
					MyGeoACCView.setRows([0, 1, 2, 3, 4, 5, 6, 7, 8, 9, NbRows-10, NbRows-9, NbRows-8, NbRows-7, NbRows-6, NbRows-5, NbRows-4, NbRows-3, NbRows-2, NbRows-1]);
				};

				UpdateMyGeoACCChart();
			}
		}
		
		function UpdateMyGeoACCChart() {
			var MyTitle;
			var MyColour;
			var MyFormat;
					
			if (SelectedIndicator == 'Daily Variation (Traffic)') {
				MyTitle = "Daily Variation (Traffic) - " + SelectedDate.toDateString();
				MyColour = 'darkGrey';
				MyFormat = '0.0%';
			}
			if (SelectedIndicator == 'Flights 2019') {
				MyTitle = "Flights 2019 - " + SelectedDate2019.toDateString();//2019
				MyColour = 'DodgerBlue';
				MyFormat = '#,###';
			}
			if (SelectedIndicator == 'Flights 2020') {
				MyTitle = "Flights 2020 - " + SelectedDate.toDateString();
				MyColour = 'darkBlue';
				MyFormat = '#,###';
			}
			if (SelectedIndicator == 'Weekly Moving Average (Traffic)') {
				MyTitle = "Weekly Moving Average (Traffic) - " + SelectedDate.toDateString();
				MyColour = 'red';
				MyFormat = '0.0%';
			}
				
			var	optionsMyGeoACCChart = {
				title: MyTitle,
				titlePosition: 'out',
				width: MyWidthGeoACCCharts,
				height: MyHeightGeoACCCharts,
				pointSize: 3,
				series: {
					0: {type:'bars',color: MyColour, pointSize: 5, targetAxisIndex:0},
				},
				hAxis: {
//					format: 'dd/mm/yyyy',
					textPosition: 'out',
					textStyle: {fontSize: 14},
					slantedText: true,
					slantedTextAngle: 90,
					gridlines: { count: MyGeoACCView.getNumberOfRows()},
				},
				vAxes: {
					0: {format: MyFormat}
				},
				legend: {
					position: 'none',
				},
				animation: {
					duration: 200,
					easing: 'inAndOut',
				},
				chartArea:{
					left:80,
					top:40,
					width:'90%',
					height:'50%'
				},
			};
			MyGeoACCChart.draw(MyGeoACCView,optionsMyGeoACCChart);
		};

//---------------Airport Breakdown------------------------
		function drawAirportBreakdownDashboard(response) {
			AirportData = response.getDataTable();

			var FormatterMiniDate = new google.visualization.DateFormat({formatType: 'short'});
			FormatterMiniDate.format(AirportData, 2);

			var FormatterZeroDecimale = new google.visualization.NumberFormat({pattern:'#,###'});
			FormatterZeroDecimale.format(AirportData, 3);
			FormatterZeroDecimale.format(AirportData, 4);

			var FormatterPercentage = new google.visualization.NumberFormat({pattern:'0.0%'});
			FormatterPercentage.format(AirportData, 5);
			FormatterPercentage.format(AirportData, 7);

			MyGeoAirportChart = new google.visualization.ComboChart(document.getElementById('MyGeoAirportChart_div'));

			UpdateAirportData();
		}

		function UpdateAirportData() {	
			if (AirportData != null) {
				var MyGeoAirportView1 = new google.visualization.DataView(AirportData);

				if (SelectedEntity == '-Total Network Manager Area') 
					MyGeoAirportView1.setRows(AirportData.getFilteredRows([{column:2, value: SelectedDate}]));
				else
					MyGeoAirportView1.setRows(AirportData.getFilteredRows([{column:2, value: SelectedDate},{column:9, value: SelectedEntity}]));

	//________________________________________________________________________________________________________
				MyTable1 = new google.visualization.Table(document.getElementById('MyTable1_div'));
				var OptionsMyTable1 = {
					width: 800,
					height: 200,
				};
	//			MyTable1.draw(MyGeoAirportView1, OptionsMyTable1);	
	//________________________________________________________________________________________________________

				if (SelectedIndicator == 'Daily Variation (Traffic)') MyGeoAirportView1.setColumns([0,5]);
				if (SelectedIndicator == 'Flights 2019') MyGeoAirportView1.setColumns([0,3]);
				if (SelectedIndicator == 'Flights 2020') MyGeoAirportView1.setColumns([0,4]);
				if (SelectedIndicator == 'Weekly Moving Average (Traffic)') MyGeoAirportView1.setColumns([0,7]);

				var MyGeoAirportView2 = new google.visualization.DataView(MyGeoAirportView1);
				MyGeoAirportView2.setRows(MyGeoAirportView2.getSortedRows([{column: 1, desc: true}]));
					
				MyGeoAirportView = new google.visualization.DataView(MyGeoAirportView2);
					
				if (SelectedEntity == '-Total Network Manager Area') {
					var NbRows = MyGeoAirportView.getNumberOfRows();
					MyGeoAirportView.setRows([0, 1, 2, 3, 4, 5, 6, 7, 8, 9, NbRows-10, NbRows-9, NbRows-8, NbRows-7, NbRows-6, NbRows-5, NbRows-4, NbRows-3, NbRows-2, NbRows-1]);
				}

				UpdateMyGeoAirportChart();
			}
		}

		function UpdateMyGeoAirportChart() {
			var MyTitle;
			var MyColour;
			var MyFormat;
					
			if (SelectedIndicator == 'Daily Variation (Traffic)') {
				MyTitle = "Daily Variation (Traffic) - " + SelectedDate.toDateString();
				MyColour = 'darkGrey';
				MyFormat = '0.0%';
			}
			if (SelectedIndicator == 'Flights 2019') {
				MyTitle = "Flights 2019 - " + SelectedDate2019.toDateString();//2019
				MyColour = 'DodgerBlue';
				MyFormat = '#,###';
			}
			if (SelectedIndicator == 'Flights 2020') {
				MyTitle = "Flights 2020 - " + SelectedDate.toDateString();
				MyColour = 'darkBlue';
				MyFormat = '#,###';
			}
			if (SelectedIndicator == 'Weekly Moving Average (Traffic)') {
				MyTitle = "Weekly Moving Average (Traffic) - " + SelectedDate.toDateString();
				MyColour = 'red';
				MyFormat = '0.0%';
			}

			var	optionsMyGeoAirportChart = {
				title: MyTitle,
				titlePosition: 'out',
				width: MyWidthGeoAirportCharts,
				height: MyHeightGeoAirportCharts,
				pointSize: 3,
				series: {
					0: {type:'bars',color: MyColour, pointSize: 5, targetAxisIndex:0},
				},
				hAxis: {
//					format: 'dd/mm/yyyy',
					textPosition: 'out',
					textStyle: {fontSize: 14},
					slantedText: true,
					slantedTextAngle: 90,
					gridlines: { count: MyGeoAirportView.getNumberOfRows()},
				},
				vAxes: {
					0: {format: MyFormat}
				},
				legend: {
					position: 'none',
				},
				animation: {
					duration: 200,
					easing: 'inAndOut',
				},
				chartArea:{
					left:80,
					top:40,
					width:'90%',
					height:'50%'
				},
			};
			MyGeoAirportChart.draw(MyGeoAirportView,optionsMyGeoAirportChart);
		};

		function drawMainDashboard() {
			SelectedEndDate = Data.getValue(Data.getNumberOfRows()-1,2);
			SelectedDate = SelectedEndDate;
			SelectedDate2019 = Data.getValue(Data.getNumberOfRows()-1,9);
			
			var FormatterMiniDate = new google.visualization.DateFormat({formatType: 'short'});
			FormatterMiniDate.format(Data, 2);

			var FormatterZeroDecimale = new google.visualization.NumberFormat({pattern:'#,###'});
			FormatterZeroDecimale.format(Data, 3);
			FormatterZeroDecimale.format(Data, 4);

			var FormatterPercentage = new google.visualization.NumberFormat({pattern:'0.0%'});
			FormatterPercentage.format(Data, 5);
			FormatterPercentage.format(Data, 7);

			var query = new google.visualization.Query('https://docs.google.com/spreadsheets/d/1fnZB1up4nV43Ggcht_rzn2nsMu3UqkHQUhKeaPKYE2E/edit?usp=sharing');
			query.send(drawACCBreakdownDashboard);

			
//________________________________________________________________________________________________________
			EntityPicker = new google.visualization.ControlWrapper({
				controlType: 'CategoryFilter',
				containerId: 'EntityPicker_div',
				dataTable: Data,
				state: {selectedValues: [SelectedEntity]},
				options: {
					filterColumnLabel: 'Entity',
					ui: {
						label: 'Select State:',
						caption: '',
//						labelStacking: 'vertical',
						allowTyping: false,
						allowMultiple: false,
						sortValues: true,
						allowNone: false,
//						cssClass: 'ClassANSPPicker',
					},
				}
			});
			EntityPicker.draw();
			google.visualization.events.addListener(EntityPicker, 'statechange', changeEntityPicker);

			function changeEntityPicker() {
				SelectedEntity = EntityPicker.getState().selectedValues[0];
				UpdateMainData();
				UpdateACCData();
				UpdateAirportData();
				UpdateMyEntityChart();
				UpdateMyEntityChartRangeFilter();
				UpdateMyGeoEntityChart();
				SelectEntityInGeoEntityChart();
			};	

//________________________________________________________________________________________________________
			var dataIndicators = google.visualization.arrayToDataTable([
				['Indicator'],
				['Daily Variation (Traffic)'],
				['Flights 2019'],
				['Flights 2020'],
				['Weekly Moving Average (Traffic)'],
			]);

			IndicatorPicker = new google.visualization.ControlWrapper({
				controlType: 'CategoryFilter',
				containerId: 'IndicatorPicker_div',
				dataTable: dataIndicators,
				state: {selectedValues: [SelectedIndicator]},
				options: {
					filterColumnLabel: 'Indicator',
					ui: {
						label: 'Select Indicator:',
						caption: '',
//						labelStacking: 'vertical',
						allowTyping: false,
						allowMultiple: false,
						sortValues: false,
						allowNone: false,
//						cssClass: 'ClassANSPPicker',
					},
				}
			});
			IndicatorPicker.draw();
			google.visualization.events.addListener(IndicatorPicker, 'statechange', changeIndicatorPicker);

			function changeIndicatorPicker() {
				SelectedIndicator = IndicatorPicker.getState().selectedValues[0];
				UpdateMainData();
				UpdateACCData();
				UpdateAirportData();
				UpdateMyEntityChart();
				UpdateMyGeoEntityChart();
				SelectEntityInGeoEntityChart();
			};
//________________________________________________________	

			UpdateMainData();

//________________________________________________________
			MyEntityChart = new google.visualization.ComboChart(document.getElementById('MyEntityChart_div'));
			google.visualization.events.addListener(MyEntityChart, 'select', selectMyEntityChart);
			UpdateMyEntityChart();

			UpdateMyEntityChartRangeFilter();
			
			MyGeoEntityChart = new google.visualization.ComboChart(document.getElementById('MyGeoEntityChart_div'));
			google.visualization.events.addListener(MyGeoEntityChart, 'select', selectMyGeoEntityChart);
			UpdateMyGeoEntityChart();
		};

//________________________________________________________________________________________________________
		function UpdateMainData() {	
			MyGeoEntityView = new google.visualization.DataView(Data);
			MyGeoEntityView.setRows(Data.getFilteredRows([{column:2, value: SelectedDate, minValue: SelectedStartDate, maxValue: SelectedEndDate}]));

			var DataMyGeoEntityView = new google.visualization.DataTable();
			DataMyGeoEntityView1 = MyGeoEntityView.toDataTable()

			MyGeoEntityView1 = new google.visualization.DataView(DataMyGeoEntityView1);
			if (SelectedIndicator == 'Daily Variation (Traffic)') MyGeoEntityView1.setColumns([0,5]);
			if (SelectedIndicator == 'Flights 2019') MyGeoEntityView1.setColumns([0,3]);
			if (SelectedIndicator == 'Flights 2020') MyGeoEntityView1.setColumns([0,4]);
			if (SelectedIndicator == 'Weekly Moving Average (Traffic)') MyGeoEntityView1.setColumns([0,7]);
			MyGeoEntityView1.setRows(MyGeoEntityView1.getSortedRows([{column: 1, desc: true}]));

	
			if ((SelectedIndicator == 'Flights 2019') || (SelectedIndicator == 'Flights 2020')) {
				var MyGeoEntityView2 = new google.visualization.DataView(MyGeoEntityView1);
				MyGeoEntityView2.setRows(1, MyGeoEntityView2.getNumberOfRows()-1);
				MyGeoEntityView1 = new google.visualization.DataView(MyGeoEntityView2);
			}

			if (SelectedEntity=="Initialisation") {
				SelectedEntity = MyGeoEntityView1.getValue(0,0);
				EntityPicker.setState({selectedValues: [SelectedEntity]});
				EntityPicker.draw();
			}
//_____________________________________________________________________________________________________________			
			MyEntityView = new google.visualization.DataView(Data);
			MyEntityView.setRows(Data.getFilteredRows([{column:0, value: SelectedEntity},{column:2, minValue: SelectedStartDate, maxValue: SelectedEndDate}]));
			
			var DataMyEntityView = new google.visualization.DataTable();
			DataMyEntityView1 = MyEntityView.toDataTable()

			MyEntityView1 = new google.visualization.DataView(DataMyEntityView1);
			MyEntityView1.setColumns([2,5,3,4,7]);
				
		//------------------------------------------
			maxSecondScale=-10000;
			minSecondScale=10000;
			for(i=0;i<MyEntityView1.getNumberOfRows();i++) {
				if (MyEntityView1.getValue(i,1)>maxSecondScale) maxSecondScale=MyEntityView1.getValue(i,1);
				if (MyEntityView1.getValue(i,1)<minSecondScale) minSecondScale=MyEntityView1.getValue(i,1);
				if (MyEntityView1.getValue(i,4)>maxSecondScale) maxSecondScale=MyEntityView1.getValue(i,4);
				if (MyEntityView1.getValue(i,4)<minSecondScale) minSecondScale=MyEntityView1.getValue(i,4);
			}
//			alert(maxSecondScale);

		};
//________________________________________________________________________________________________________

		function selectMyEntityChart() {
			if(MyEntityChart.getSelection() != "") {
				SelectedDate = MyEntityView1.getValue(MyEntityChart.getSelection()[0].row, 0);
				SelectedDate2019 = MyEntityView.getValue(MyEntityChart.getSelection()[0].row, 9);

				SelectedIndicator = MyEntityView1.getColumnLabel(MyEntityChart.getSelection()[0].column);
				UpdateMainData();
				UpdateACCData();
				UpdateAirportData();
				UpdateMyEntityChart();
				UpdateMyGeoEntityChart();
				SelectEntityInGeoEntityChart();
				IndicatorPicker.setState({selectedValues: [SelectedIndicator]});
				IndicatorPicker.draw();
			}
		}
//________________________________________________________________________________________________________

		function UpdateMyEntityChart() {
			var SecondPartOfTheTitle;
			if (SelectedEntity == '-Total Network Manager Area') SecondPartOfTheTitle = ' (All flights)'; else SecondPartOfTheTitle = ' (Arr/Dep flights)';
			var	optionsMyEntityChart = {
				title: SelectedEntity + SecondPartOfTheTitle,
				titlePosition: 'out',
				width: MyWidthCharts,
				height: MyHeightCharts,
				pointSize: 3,
				dataOpacity: 0.5,
				series: {
					0: {type:'bars', color:'darkGrey', targetAxisIndex:1},
					1: {type:'line', dataOpacity:1.0, color:'DodgerBlue', pointSize: 5, lineWidth: 2, targetAxisIndex:0},
					2: {type:'line', dataOpacity:1.0, color:'darkBlue', pointSize: 5, lineWidth: 2, targetAxisIndex:0},
					3: {type:'line', dataOpacity:1.0, color:'red', pointSize: 5, lineWidth: 2, lineDashStyle: [4, 4], targetAxisIndex:1},
				},
				hAxis: {
					format: 'MMM dd, yyyy',
					textPosition: 'out',
					textStyle: {fontSize: 14},
					slantedText: true,
					slantedTextAngle: 90,
					gridlines: {count: MyEntityView1.getNumberOfRows()},
				},
				vAxes: {
					0: {format: '#,###'},
//					1: {format: '0%', maxValue: maxSecondScale, minValue: minSecondScale}
					1: {format: '0%', viewWindow: {max: maxSecondScale+0.02, min: minSecondScale-0.02}}
//					1: {format: '0%', viewWindow: {viewWindowMode: 'maximized'}}
				},
				legend: {
					position: 'bottom',
				},
				animation: {
					duration: 200,
					easing: 'inAndOut',
				},
				chartArea:{
					left:80,
					top:40,
					width:'90%',
					height:'60%'
				},
			};
				
			MyEntityChart.draw(MyEntityView1,optionsMyEntityChart);
			SelectDateInEntityChart();
		};

//________________________________________________________________________________________________________
			
		function UpdateMyEntityChartRangeFilter() {
			MyEntityView = new google.visualization.DataView(Data);
			MyEntityView.setRows(Data.getFilteredRows([{column:0, value: SelectedEntity}]));

			var DataMyEntityView = new google.visualization.DataTable();
			DataMyEntityView1 = MyEntityView.toDataTable()

			MyEntityChartRangeFilterView = new google.visualization.DataView(DataMyEntityView1);
			MyEntityChartRangeFilterView.setColumns([2,5,3,4,7]);

			MyEntityChartRangeFilter = new google.visualization.ControlWrapper({
				controlType: 'ChartRangeFilter',
				containerId: 'MyEntityChartRangeFilter_div',
				dataTable: MyEntityChartRangeFilterView,
				options: {
					filterColumnIndex: 0,
					state: {range: {start: SelectedStartDate, end: SelectedEndDate}},
					ui: {
						chartOptions: {
							width: MyWidthCharts,
							height: 100,
							dataOpacity: 0.5,
							series: {
								0: {type:'bars', color:'darkGrey', targetAxisIndex:1},
								1: {type:'line', dataOpacity:1.0, color:'DodgerBlue', pointSize: 5, lineWidth: 2, targetAxisIndex:0},
								2: {type:'line', dataOpacity:1.0, color:'darkBlue', pointSize: 5, lineWidth: 2, targetAxisIndex:0},
								3: {type:'line', dataOpacity:1.0, color:'red', pointSize: 5, lineWidth: 2, lineDashStyle: [4, 4], targetAxisIndex:1},
							},
//							colors: myColors,
							chartArea: {
								left:80,
//								top:00,
								width: '90%',
							},
							hAxis: {
//								format: '0',
//								slantedText: true,
//								slantedTextAngle: 90,
//								ticks: MyTicks2,
							},
							snapToData: true,
						},
					}
				}
			});
			MyEntityChartRangeFilter.setState({range: {start: SelectedStartDate, end: SelectedEndDate}});
			MyEntityChartRangeFilter.draw();
			google.visualization.events.addListener(MyEntityChartRangeFilter, 'statechange', changeMyEntityChartRangeFilter);

			function changeMyEntityChartRangeFilter(){
				SelectedStartDate = MyEntityChartRangeFilter.getState().range.start;
				SelectedEndDate = MyEntityChartRangeFilter.getState().range.end;

				UpdateMainData();
				UpdateMyEntityChart();
			};
		}
//________________________________________________________________________________________________________
		function SelectDateInEntityChart() {
			for(j = 0; j < MyEntityView1.getNumberOfRows(); j++) {
				if (MyEntityView1.getValue(j,0).toDateString() == SelectedDate.toDateString()) {
//					alert("Trouvé " + SelectedDate + " en " + j);
					MyEntityChart.setSelection([{row: j , column:null}]);
				}
			}
		};			

//________________________________________________________________________________________________________
		function selectMyGeoEntityChart() {
			if(MyGeoEntityChart.getSelection() != "") {
				SelectedEntity = MyGeoEntityView1.getValue(MyGeoEntityChart.getSelection()[0].row, 0);
				EntityPicker.setState({selectedValues: [SelectedEntity]});
				EntityPicker.draw();
				UpdateMainData();
				UpdateMyEntityChartRangeFilter();
				UpdateACCData()
				UpdateAirportData();
				UpdateMyEntityChart();
				UpdateMyGeoEntityChart();
			}
		}
			
		function UpdateMyGeoEntityChart() {
			var MyTitle;
			var MyColour;
			var MyFormat;
				
			if (SelectedIndicator == 'Daily Variation (Traffic)') {
				MyTitle = "Daily Variation (Traffic) - " + SelectedDate.toDateString();
				MyColour = 'darkGrey';
				MyFormat = '0.0%';
			}
			if (SelectedIndicator == 'Flights 2019') {
				MyTitle = "Flights 2019 - " + SelectedDate2019.toDateString();//2019
				MyColour = 'DodgerBlue';
				MyFormat = '#,###';
			}
			if (SelectedIndicator == 'Flights 2020') {
				MyTitle = "Flights 2020 - " + SelectedDate.toDateString();
				MyColour = 'darkBlue';
				MyFormat = '#,###';
			}
			if (SelectedIndicator == 'Weekly Moving Average (Traffic)') {
				MyTitle = "Weekly Moving Average (Traffic) - " + SelectedDate.toDateString();
				MyColour = 'red';
				MyFormat = '0.0%';
			}

			var SecondPartOfTheTitle;
			if (SelectedEntity == '-Total Network Manager Area') SecondPartOfTheTitle = ' (All flights)'; else SecondPartOfTheTitle = ' (Arr/Dep flights)';

			var	optionsMyGeoEntityChart = {
				title: MyTitle + SecondPartOfTheTitle,
				titlePosition: 'out',
				width: MyWidthGeoCharts,
				height: MyHeightGeoCharts,
				pointSize: 3,
				series: {
					0: {type:'bars',color: MyColour, pointSize: 5, targetAxisIndex:0},
				},
				hAxis: {
//						format: 'dd/mm/yyyy',
					textPosition: 'out',
					textStyle: {fontSize: 14},
					slantedText: true,
					slantedTextAngle: 90,
					gridlines: { count: MyGeoEntityView1.getNumberOfRows()},
				},
				vAxes: {
					0: {format: MyFormat}
				},
				vAxis: {
					viewWindow: {
//						max: maxY,
//						min: -1.0
					}
				},
				legend: {
					position: 'none',
				},
				animation: {
					duration: 200,
					easing: 'inAndOut',
				},
				chartArea:{
					left:80,
					top:40,
					width:'90%',
					height:'50%'
				},
			};
				
			MyGeoEntityChart.draw(MyGeoEntityView1,optionsMyGeoEntityChart);
			SelectEntityInGeoEntityChart();
		};
			
//________________________________________________________________________________________________________
		function SelectEntityInGeoEntityChart() {
			for(j = 0; j < MyGeoEntityView1.getNumberOfRows(); j++) {
				if (MyGeoEntityView1.getValue(j,0) == SelectedEntity) {
//						alert("Trouvé " + SelectedEntity + " en " + j);
					MyGeoEntityChart.setSelection([{row: j , column:null}]);
				}
			}
		};
</script>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-RJ3R0C35X7"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-RJ3R0C35X7');
</script>
